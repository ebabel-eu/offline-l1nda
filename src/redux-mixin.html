<link rel="import" href="../bower_components/polymer-redux/polymer-redux.html">
<script src="../node_modules/redux/dist/redux.js"></script>

<script>
  const readStorage = (key) =>
    (
      localStorage[key]
      && Array.isArray(JSON.parse(localStorage[key]))
      && JSON.parse(localStorage[key]).sort()
    ) || [];

  const startTimes = readStorage('startTimes');
  const endTimes = readStorage('endTimes');
  const employees = readStorage('employees');
  const layers = readStorage('layers');
  const shifts = readStorage('shifts');

  // Setup a Redux store
  const initial = {
    mainTitle: 'L1NDA',
    days: [
      'Sunday',
      'Monday',
      'Tuesday',
      'Wednesday',
      'Thursday',
      'Friday',
      'Saturday',
    ],
    startTimes,
    endTimes,
    employees,
    layers,
    shifts,
  };

  const reducer = (state, action) => {
    if (!state) {
      return initial;
    }

    switch (action.type) {
      case 'UPDATE_MAIN_TITLE':
        return Object.assign({}, state, {
          mainTitle: action.mainTitle,
        });
      case 'ADD_SHIFT':
        const shifts = state.shifts.slice(0);
        shifts.push(action.shift);
        return Object.assign({}, state, { shifts });
      case 'DELETE_ALL_SHIFTS':
        return Object.assign({}, state, { shifts: [] });
      default:
        return state;
    }
  };

  const store = Redux.createStore(reducer, initial);

  // Export the ReduxMixin
  ReduxMixin = PolymerRedux(store);
</script>
