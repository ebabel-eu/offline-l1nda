<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-progress-button/paper-progress-button.html">

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">

<link rel="import" href="shared-styles.html">
<link rel="import" href="l1nda-shift.html">

<dom-module id="l1nda-schedule">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        padding: 10px;
      }

      paper-dropdown-menu {
        margin-right: 10px;
      }
    </style>

    <div class="card">
      <h1>Friday</h1>
      <template is="dom-if" if=[[shifts]]>
        <template is="dom-repeat" items="[[shifts]]">
          <l1nda-shift
            start={{item.start}}
            end={{item.end}}
            employee={{item.employee}}
            layer={{item.layer}}
          ></l1nda-shift>
        </template>
      </template>

      <template is="dom-if" if=[[!shifts]]>
        <h2>No shift yet</h2>
        <p>Add them with the form below, please.</p>
      </template>

      <form>
        <paper-dropdown-menu label="Start">
          <paper-listbox
            slot="dropdown-content"
            on-selected-changed="onSelectDropdown"
          >
            <template is="dom-repeat" items=[[startTimes]]>
              <paper-item>{{item}}</paper-item>
            </template>
          </paper-listbox>
        </paper-dropdown-menu>

        <paper-dropdown-menu label="End">
          <paper-listbox
            slot="dropdown-content"
            on-selected-changed="onSelectDropdown"
          >
            <template is="dom-repeat" items=[[endTimes]]>
              <paper-item>{{item}}</paper-item>
            </template>
          </paper-listbox>
        </paper-dropdown-menu>

        <paper-dropdown-menu label="Employee">
          <paper-listbox
            slot="dropdown-content"
            on-selected-changed="onSelectDropdown"
          >
            <template is="dom-repeat" items=[[employees]]>
              <paper-item>{{item}}</paper-item>
            </template>
          </paper-listbox>
        </paper-dropdown-menu>

        <paper-dropdown-menu label="Layer">
          <paper-listbox
            slot="dropdown-content"
            on-selected-changed="onSelectDropdown"
          >
            <template is="dom-repeat" items=[[layers]]>
              <paper-item>{{item}}</paper-item>
            </template>
          </paper-listbox>
        </paper-dropdown-menu>
    
        <paper-progress-button
          active="[[active]]"
          active-text="Add"
          inactive-text="Adding..."
          raised
          on-click="handleClick"
          style="margin: 20px 0 20px -5px;"
        >
        </paper-progress-button>
      </form>
    </div>

  </template>

  <script>
    class L1ndaSchedule extends Polymer.Element {
      static get is() { return 'l1nda-schedule'; }

      handleClick() {
        // If using Ajax, set this.active = false; when the call starts in beforeSend.

        const {
          start,
          end,
          employee,
          layer,
        } = this.shift;

        this.push('shifts', {
          start,
          end,
          employee,
          layer,
          timestamp: Date.now(),
        });

        localStorage['shifts'] = JSON.stringify(this.shifts);

        // If using Ajax, set this.active = true; when the call is complete in finally.
      }

      onSelectDropdown(e) {
        const label = e.target.parentNode.label.toLowerCase();
        const value = e.target.selectedItems[0].textContent;

        this.shift[label] = value;
      }

      constructor() {
        super();

        this.shift = {};

        this.active = true;

        this.shifts = localStorage['shifts'] && JSON.parse(localStorage['shifts']) || [];

        this.startTimes = localStorage['startTimes'] && JSON.parse(localStorage['startTimes']).sort()
          || [ '07:45', '08:00', '08:15', '08:30', '08:45', '09:00', '09:15', '09:30' ].sort();

        this.endTimes = localStorage['endTimes'] && JSON.parse(localStorage['endTimes']).sort()
          || [ '16:30', '16:45', '17:00', '17:15', '17:30', '17:45', '18:00', '18:15' ].sort();

        this.employees = localStorage['employees'] && JSON.parse(localStorage['employees']).sort()
          || [ 'Susanne', 'Remy', 'Richard', 'Nadjib', 'Alson', 'Wouter', 'Tim', 'Rick', 'Linden', 'Masinde', 'Todd', 'Jochem' ].sort();

        this.layers = localStorage['layers'] && JSON.parse(localStorage['layers']).sort()
          || [ 'Cryostasis', 'Cyberspace', 'Dystopia', 'Homeworld', 'Hyperdrive', 'Multiverse', 'Spaceship' ].sort();
      }
    }

    window.customElements.define(L1ndaSchedule.is, L1ndaSchedule);
  </script>
</dom-module>
