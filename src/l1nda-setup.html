<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-progress-button/paper-progress-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">

<link rel="import" href="shared-styles.html">

<dom-module id="l1nda-setup">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        padding: 10px;
      }

      .item {
        background-color: var(--app-dark-color);
        color: white;
        display: inline-block;
        padding: 2px 8px;
        margin: 0 6px 8px 0;
        border-radius: 12px;
      }
    </style>

    <div class="card">
      <h1>Setup</h1>

      <h2>Start times</h2>
      <template is="dom-repeat" items="[[startTimes]]">
        <span class="item">
          {{item}}
        </span>
      </template>
      <form>
        <paper-input
          label="New start time"
          on-change="updateStartTime"
        >
        </paper-input>
        <p>
          <paper-progress-button
            active="[[active]]"
            active-text="Add start time"
            inactive-text="Adding..."
            raised
            on-click="addStartTime"
            style="margin: 20px 0 20px -5px;"
          >
          </paper-progress-button>
        </p>
      </form>

      <h2>End times</h2>
      <template is="dom-repeat" items="[[endTimes]]">
        <span class="item">
          {{item}}
        </span>
      </template>
      <form>
        <paper-input
          label="New end time"
          on-change="updateEndTime"
        >
        </paper-input>
        <p>
          <paper-progress-button
            active="[[active]]"
            active-text="Add end time"
            inactive-text="Adding..."
            raised
            on-click="addEndTime"
            style="margin: 20px 0 20px -5px;"
          >
          </paper-progress-button>
        </p>
      </form>

      <h2>Employees</h2>
      <template is="dom-repeat" items="[[employees]]">
        <span class="item">
          {{item}}
        </span>
      </template>
      <form>
        <paper-input
          label="New employee"
          on-change="updateEmployee"
        >
        </paper-input>
        <p>
          <paper-progress-button
            active="[[active]]"
            active-text="Add employee"
            inactive-text="Adding..."
            raised
            on-click="addEmployee"
            style="margin: 20px 0 20px -5px;"
          >
          </paper-progress-button>
        </p>
      </form>

      <h2>Layers</h2>
      <template is="dom-repeat" items="[[layers]]">
        <span class="item">
          {{item}}
        </span>
      </template>
      <form>
        <paper-input
          label="New layer"
          on-change="updateLayer"
        >
        </paper-input>
        <p>
          <paper-progress-button
            active="[[active]]"
            active-text="Add layer"
            inactive-text="Adding..."
            raised
            on-click="addLayer"
            style="margin: 20px 0 20px -5px;"
          >
          </paper-progress-button>
        </p>
      </form>

    </div>
  </template>

  <script>
    class L1ndaSetup extends Polymer.Element {
      static get is() { return 'l1nda-setup'; }

      // todo: refactor all the repetitions in this file between update.. and add... functions.

      updateStartTime(e) {
        this.startTime = e.currentTarget.$.nativeInput.value;
      }
      addStartTime() {
        this.push('startTimes', this.startTime);

        // Remove duplicates and sort the values.
        this.startTimes = Array.from(new Set(this.startTimes)).sort();

        localStorage['startTimes'] = JSON.stringify(this.startTimes);
      }
 
      updateEndTime(e) {
        this.endTime = e.currentTarget.$.nativeInput.value;
      }
      addEndTime() {
        this.push('endTimes', this.endTime);
        this.endTimes = Array.from(new Set(this.endTimes)).sort();
        localStorage['endTimes'] = JSON.stringify(this.endTimes);
      }

      updateEmployee(e) {
        this.employee = e.currentTarget.$.nativeInput.value;
      }
      addEmployee() {
        this.push('employees', this.employee);
        this.employees = Array.from(new Set(this.employees)).sort();
        localStorage['employees'] = JSON.stringify(this.employees);
      }

      updateLayer(e) {
        this.layer = e.currentTarget.$.nativeInput.value;
      }
      addLayer() {
        this.push('layers', this.layer);
        this.layers = Array.from(new Set(this.layers)).sort();
        localStorage['layers'] = JSON.stringify(this.layers);
      }

      constructor() {
        super();

        // todo: refactor all the repetitions in this file and in l1nda-schedule.html

        this.startTime = null;
        this.endTime = null;
        this.employee = null;
        this.layer = null;

        this.startTimes = localStorage['startTimes'] && JSON.parse(localStorage['startTimes']).sort()
          || [ '09:00' ];

        this.endTimes = localStorage['endTimes'] && JSON.parse(localStorage['endTimes']).sort()
          || [ '17:30' ];

        this.employees = localStorage['employees'] && JSON.parse(localStorage['employees']).sort()
          || [];

        this.layers = localStorage['layers'] && JSON.parse(localStorage['layers']).sort()
          || [];
      }
    }

    window.customElements.define(L1ndaSetup.is, L1ndaSetup);
  </script>
</dom-module>
